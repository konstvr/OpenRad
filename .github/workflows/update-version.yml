name: Auto Cache Buster

on:
  push:
    branches:
      - main
    paths:
      - 'js/*.js' # Only run if JS files change

permissions:
  contents: write

jobs:
  update-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Update Version Tags
        run: |
          # Get short commit hash (e.g., a1b2c3d)
          HASH=$(git rev-parse --short HEAD)
          
          # Replace ?v=... with ?v=HASH in all HTML files
          # This regex looks for: src="js/filename.js?v=ANYTHING"
          sed -i -E "s/(src=\"js\/[a-zA-Z0-9_]+\.js\?v=)[^\"]*/\1$HASH/g" *.html
          
      - name: Commit and Push Changes
        run: |
          git config --global user.name "Cache Buster Bot"
          git config --global user.email "bot@noreply.github.com"
          git add *.html
          # Only commit if there are changes
          git diff --quiet && git diff --staged --quiet || (git commit -m "Auto-update JS version to $HASH" && git push)