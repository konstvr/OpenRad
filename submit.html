<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Model - OpenRad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' },
                        violet: { 500: '#8b5cf6', 600: '#7c3aed' }
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100 transition-colors duration-300">

    <div class="min-h-screen flex flex-col">
        <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-40">
            <div class="max-w-4xl mx-auto px-4 h-16 flex items-center justify-between">
                <a href="index.html" class="flex items-center gap-3">
                    <div class="relative w-8 h-8 flex items-center justify-center">
                        <div class="absolute inset-0 bg-gradient-to-tr from-blue-600 to-violet-600 rounded-lg shadow-lg opacity-100"></div>
                        <span class="relative text-white font-bold text-sm">OR</span>
                    </div>
                    <h1 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">OpenRad</h1>
                </a>
                <a href="index.html" class="text-sm font-medium text-slate-500 hover:text-slate-900 dark:text-slate-400 dark:hover:text-white">Back to Overview</a>
            </div>
        </header>

        <main class="flex-1 max-w-4xl mx-auto w-full px-4 py-10">
            
            <div class="mb-8 text-center">
                <h2 class="text-3xl font-bold text-slate-900 dark:text-white">Submit a Model</h2>
                <p class="mt-2 text-slate-500 dark:text-slate-400">Fill in the details below to generate a submission issue.</p>
            </div>

            <form id="submissionForm" class="space-y-8 bg-white dark:bg-slate-800 p-8 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm" onsubmit="generateIssue(event)">
                
                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-violet-600 dark:text-violet-400 border-b border-slate-200 dark:border-slate-700 pb-2">1. Identification</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Model Name *</label>
                            <input type="text" id="modelName" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Github / Other Repository Link *</label>
                            <input type="url" id="modelLink" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-violet-600 dark:text-violet-400 border-b border-slate-200 dark:border-slate-700 pb-2">2. Source Paper & Authors</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Paper Title *</label>
                            <input type="text" id="paperTitle" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">DOI / Arxiv ID *</label>
                            <input type="text" id="modelDOI" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Authors (Comma separated) *</label>
                        <input type="text" id="modelAuthors" required placeholder="e.g. John Doe, Jane Smith" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Organizations (Comma separated) *</label>
                        <input type="text" id="modelOrgs" required placeholder="e.g. Stanford University, MIT" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Funding *</label>
                            <input type="text" id="modelFunding" required placeholder="Grant numbers / Agencies" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Ethical Review *</label>
                            <input type="text" id="modelEthics" required placeholder="IRB Number / License info" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-violet-600 dark:text-violet-400 border-b border-slate-200 dark:border-slate-700 pb-2">3. Clinical & Imaging</h3>
                    
                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Indexing Codes (Select all that apply) *</label>
                        <div class="flex flex-wrap gap-2" id="modalityCheckboxes"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Modality Description *</label>
                            <input type="text" id="imagingModalityDesc" required placeholder="e.g. Cardiac Magnetic Resonance Imaging (CMR)" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Procedure Name *</label>
                            <input type="text" id="procedureName" required placeholder="e.g. Estimation of Pulmonary Pressure" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Indications for Use *</label>
                        <textarea id="modelIndications" required rows="2" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-violet-600 dark:text-violet-400 border-b border-slate-200 dark:border-slate-700 pb-2">4. Technical Properties</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Use Case *</label>
                            <select id="modelUse" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                                <option>Segmentation</option>
                                <option>Classification</option>
                                <option>Detection</option>
                                <option>Foundation</option>
                                <option>LLM</option>
                                <option>Generative</option>
                                <option>Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Validation *</label>
                            <select id="modelValidation" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                                <option value="internal">Internal Only</option>
                                <option value="external">External</option>
                                <option value="none">None/Unknown</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Availability *</label>
                            <select id="modelAvailability" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                                <option>Open Access</option>
                                <option>Restricted</option>
                                <option>Upon Request</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Architecture *</label>
                            <input type="text" id="modelArch" required placeholder="e.g. U-Net, ResNet50" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Dataset *</label>
                            <input type="text" id="modelDataset" required placeholder="e.g. Private, LIDC-IDRI" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Sustainability (Hardware/Time) *</label>
                        <input type="text" id="modelSustainability" required placeholder="e.g. Trained on 4x A100 for 24h" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Limitations *</label>
                        <textarea id="modelLimitations" required rows="2" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Regulatory Comment *</label>
                        <input type="text" id="modelRegulatory" required placeholder="e.g. Research use only" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                    </div>
                </div>

                <div class="space-y-4">
                    <h3 class="text-lg font-bold text-violet-600 dark:text-violet-400 border-b border-slate-200 dark:border-slate-700 pb-2">5. Status & Performance</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Weights Available? *</label>
                            <select id="hasWeights" required class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold uppercase text-slate-500 mb-2">Interactive Demo? (Optional)</label>
                            <select id="hasDemo" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Demo Link (Optional)</label>
                        <input type="text" id="demoLink" placeholder="https://huggingface.co/spaces/..." class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none">
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase text-slate-500 mb-1">Performance Comments (Metrics) *</label>
                        <textarea id="modelPerformance" required placeholder="e.g. Accuracy: 95%; F1-Score: 0.92" rows="2" class="w-full px-3 py-2 bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                    </div>
                </div>

                <div class="pt-4">
                    <button type="submit" class="w-full py-4 px-4 bg-violet-600 hover:bg-violet-700 text-white font-bold rounded-xl transition shadow-lg shadow-violet-500/30 flex items-center justify-center gap-2 text-lg">
                        <span>Review & Submit on GitHub</span>
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                    </button>
                    <p class="text-xs text-center text-slate-400 mt-3">This will open a GitHub Issue with your model data formatted as JSON.</p>
                </div>
            </form>
        </main>
    </div>

    <script>
        // --- CONFIGURATION ---
        const GITHUB_REPO = "ObiWan-AI/OpenRad"; 

        const MODALITIES = [
            "BR", "BQ", "CA", "CH", "CT", "DM", "ED", "ER", "GI", "GU", 
            "HN", "HP", "IN", "IR", "LM", "MI", "MK", "MR", "NM", "NR", 
            "OB", "OI", "OT", "PD", "PH", "PR", "SQ", "RO", "RS", "US", "VA"
        ];
        
        // --- INIT ---
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        const modContainer = document.getElementById('modalityCheckboxes');
        MODALITIES.forEach(mod => {
            const label = document.createElement('label');
            label.className = "flex items-center gap-2 cursor-pointer bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-600 px-3 py-1.5 rounded-lg hover:border-violet-500 transition";
            label.innerHTML = `
                <input type="checkbox" value="${mod}" class="w-4 h-4 text-violet-600 rounded focus:ring-violet-500">
                <span class="text-xs font-bold">${mod}</span>
            `;
            modContainer.appendChild(label);
        });

        // --- GENERATE JSON ---
        function generateIssue(e) {
            e.preventDefault();

            const getVal = (id) => document.getElementById(id).value;

            // Arrays
            const selectedMods = Array.from(modContainer.querySelectorAll('input:checked')).map(cb => cb.value);
            const authors = getVal('modelAuthors').split(',').map(s => ({ "Name": s.trim() }));
            const orgs = getVal('modelOrgs').split(',').map(s => ({ "Name": s.trim() }));

            // Logic for Demo Link
            let finalDemoLink = getVal('demoLink');
            if (finalDemoLink.toLowerCase() === 'null' || finalDemoLink.trim() === '') {
                finalDemoLink = null;
            }

            const modelJson = {
                "$schema": "https://atlas.rsna.org/schemas/2025-11/model.json",
                "Model": {
                    "Name": getVal('modelName'),
                    "Link": getVal('modelLink'),
                    "Indexing": {
                        "Content": selectedMods
                    },
                    "Descriptors": {
                        "Authors": authors,
                        "Organizations": orgs,
                        "Funding": getVal('modelFunding'),
                        "Ethical review": getVal('modelEthics'),
                        "References": [
                            {
                                "Title": getVal('paperTitle'),
                                "DOI": getVal('modelDOI')
                            }
                        ]
                    },
                    "Imaging": {
                        "Modalities": [getVal('imagingModalityDesc')],
                        "Procedures": [{ "Name": getVal('procedureName') }],
                        "Comments": ""
                    },
                    "Model properties": {
                        "Architecture": getVal('modelArch'),
                        "Sustainability": getVal('modelSustainability'),
                        "Limitations": getVal('modelLimitations'),
                        "Indications for use": getVal('modelIndications'),
                        "Regulatory information": {
                            "Comment": getVal('modelRegulatory')
                        },
                        "Use": getVal('modelUse'),
                        "Availability": getVal('modelAvailability'),
                        "Dataset": getVal('modelDataset'),
                        "Validation": getVal('modelValidation'),
                        "repository_analysis": {
                            "contains_weights": getVal('hasWeights'), // "yes" or "no" from select
                            "demo_available": getVal('hasDemo'),       // "yes" or "no" from select
                            "demo_link": finalDemoLink
                        }
                    },
                    "Model performance": {
                        "Metrics": [],
                        "Comments": getVal('modelPerformance')
                    }
                }
            };

            const jsonString = JSON.stringify(modelJson, null, 4);
            const title = encodeURIComponent(`Model Submission: ${getVal('modelName')}`);
            const body = encodeURIComponent(`### New Model Submission\n\nPlease review the generated JSON below:\n\n\`\`\`json\n${jsonString}\n\`\`\``);
            
            const url = `https://github.com/${GITHUB_REPO}/issues/new?title=${title}&body=${body}`;
            window.open(url, '_blank');
        }
    </script>
</body>
</html>