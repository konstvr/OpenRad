<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Submit Model - OpenRad</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { slate: { 850: '#1e293b', 900: '#0f172a' }, violet: { 500: '#8b5cf6', 600: '#7c3aed' } }
                }
            }
        }
    </script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        [x-cloak] {
            display: none !important;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-100 min-h-screen" x-data="submitApp"
    x-init="init()">

    <!-- Re-using app.js for shared config but we need our own app logic too -->
    <script src="js/app.js?v=809ab55"></script>
    <script src="js/submit.js?v=809ab55"></script>

    <div class="max-w-4xl mx-auto px-4 py-8">

        <div class="mb-6 flex justify-between items-center">
            <a href="index.html"
                class="text-sm font-medium text-slate-500 hover:text-violet-600 flex items-center gap-1 transition">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Back to Overview
            </a>
        </div>

        <div x-show="loading" class="text-center py-20">
            <svg class="animate-spin h-8 w-8 text-violet-600 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg"
                fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
            <span class="text-slate-500">Checking auth...</span>
        </div>

        <div x-show="!loading && user" x-cloak>
            <h1 class="text-3xl font-bold mb-2">
                <span x-text="submissionId ? 'Edit Submission' : 'Submit a New Model'"></span>
            </h1>

            <!-- Success Message -->
            <div x-show="success"
                class="bg-green-100 border border-green-200 text-green-700 p-6 rounded-xl mb-8 flex items-center gap-4">
                <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                <div>
                    <h3 class="font-bold text-lg" x-text="submissionId ? 'Changes Saved!' : 'Submission Received!'">
                    </h3>
                    <p
                        x-text="submissionId ? 'Your changes have been updated.' : 'Your model has been submitted for review.'">
                    </p>
                    <div class="mt-4 flex gap-4">
                        <a href="index.html" class="text-sm font-bold underline hover:text-green-800">Return to Home</a>
                        <template x-if="submissionId">
                            <!-- E.g. go back to admin if came from there, but hard to know safely -->
                            <button @click="window.close()"
                                class="text-sm font-bold underline hover:text-green-800">Close Window</button>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div x-show="error" class="bg-red-100 border border-red-200 text-red-700 p-4 rounded-xl mb-8">
                <p class="font-bold">Error:</p>
                <p x-text="error"></p>
            </div>

            <form x-show="!success" @submit.prevent="submitModel()"
                class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 overflow-hidden">

                <div class="p-8 space-y-8">

                    <!-- 1. Identification -->
                    <section>
                        <h3 class="text-lg font-bold mb-4 text-violet-600 border-b border-slate-100 pb-2">1.
                            Identification & Resources</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="md:col-span-2">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Model Name <span
                                        class="text-red-500">*</span></label>
                                <input type="text" x-model="formData.name" required
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Repository Link
                                    <span class="text-red-500">*</span></label>
                                <input type="url" x-model="formData.link" required placeholder="https://github.com/..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Demo Link</label>
                                <input type="url" x-model="formData.demo_link" placeholder="Optional"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                            <div class="md:col-span-2">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Paper Title <span
                                        class="text-red-500">*</span></label>
                                <input type="text" x-model="formData.paper_title" required
                                    placeholder="Title of the paper"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">DOI <span
                                        class="text-red-500">*</span></label>
                                <input type="text" x-model="formData.doi" required placeholder="10.1007/..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>
                            <div class="md:col-span-3">
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Paper Link (Direct
                                    URL)</label>
                                <input type="url" x-model="formData.paper_link" placeholder="https://arxiv.org/..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>
                        </div>
                    </section>

                    <!-- 2. Descriptors -->
                    <section>
                        <h3 class="text-lg font-bold mb-4 text-violet-600 border-b border-slate-100 pb-2">2. Descriptors
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Authors (Comma
                                    Separated) <span class="text-red-500">*</span></label>
                                <textarea x-model="formData.authors" rows="2" placeholder="Startups, Universities..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Organizations
                                    (Semicolon Separated) <span class="text-red-500">*</span></label>
                                <textarea x-model="formData.organizations" rows="2" placeholder="List organizations..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Funding <span
                                        class="text-red-500">*</span></label>
                                <input type="text" x-model="formData.funding"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Ethical
                                    Review <span class="text-red-500">*</span></label>
                                <input type="text" x-model="formData.ethical_review"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>
                        </div>
                    </section>

                    <!-- 3. Technical Properties -->
                    <section>
                        <h3 class="text-lg font-bold mb-4 text-violet-600 border-b border-slate-100 pb-2">3. Model
                            Properties</h3>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Architecture <span
                                        class="text-red-500">*</span></label>
                                <input type="text" x-model="formData.architecture" required
                                    placeholder="e.g. U-Net, ResNet50..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Dataset <span
                                        class="text-red-500">*</span></label>
                                <textarea x-model="formData.dataset" rows="2" required
                                    placeholder="Describe the training/validation data..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Indications for Use
                                    <span class="text-red-500">*</span></label>
                                <textarea x-model="formData.indications" rows="2" required placeholder="Intended use..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Limitations <span
                                        class="text-red-500">*</span></label>
                                <textarea x-model="formData.limitations" rows="2" required
                                    placeholder="Known limitations..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label
                                        class="block text-xs font-bold text-slate-500 uppercase mb-1">Sustainability</label>
                                    <input type="text" x-model="formData.sustainability" placeholder="Hardware/Time..."
                                        class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                </div>
                                <div>
                                    <label
                                        class="block text-xs font-bold text-slate-500 uppercase mb-1">Availability</label>
                                    <input type="text" x-model="formData.availability" placeholder="e.g. Open Access"
                                        class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Regulatory Info
                                        <span class="text-red-500">*</span></label>
                                    <input type="text" x-model="formData.regulatory" required
                                        placeholder="Clearance status..."
                                        class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                </div>

                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Validation
                                        Status <span class="text-red-500">*</span></label>
                                    <select x-model="formData.validation" required
                                        class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                        <option value="">Select Status...</option>
                                        <option value="internal">Internal Validation Only</option>
                                        <option value="external">External Validation</option>
                                        <option value="n/a">N/A</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 4. Categories & Repo Analysis -->
                    <section>
                        <h3 class="text-lg font-bold mb-4 text-violet-600 border-b border-slate-100 pb-2">4.
                            Categorization & Analysis</h3>

                        <!-- Weights / Demo -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Contains
                                    Weights?</label>
                                <select x-model="formData.contains_weights"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                    <option value="n/a">N/A</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Demo
                                    Available?</label>
                                <select x-model="formData.demo_available"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                        </div>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Use Cases <span
                                        class="text-red-500">*</span></label>
                                <div class="flex flex-wrap gap-3">
                                    <template x-for="uc in USE_CATEGORIES">
                                        <label
                                            class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition">
                                            <input type="checkbox" :value="uc" x-model="formData.use_cases"
                                                class="w-4 h-4 text-violet-600 rounded border-slate-300 focus:ring-violet-500">
                                            <span class="text-sm" x-text="uc"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Modalities <span
                                        class="text-red-500">*</span></label>
                                <div class="flex flex-wrap gap-3">
                                    <template x-for="mod in MODALITY_CODES">
                                        <label
                                            class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition">
                                            <input type="checkbox" :value="mod" x-model="formData.modalities"
                                                class="w-4 h-4 text-violet-600 rounded border-slate-300 focus:ring-violet-500">
                                            <span class="text-sm" x-text="FULL_MAPPING[mod] || mod"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>

                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Subspecialties
                                    <span class="text-red-500">*</span></label>
                                <div class="flex flex-wrap gap-3 max-h-60 overflow-y-auto custom-scrollbar p-1">
                                    <template x-for="spec in SUBSPECIALTY_CODES">
                                        <label
                                            class="flex items-center gap-2 cursor-pointer p-2 rounded-lg border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition">
                                            <input type="checkbox" :value="spec" x-model="formData.specialties"
                                                class="w-4 h-4 text-violet-600 rounded border-slate-300 focus:ring-violet-500">
                                            <span class="text-sm" x-text="FULL_MAPPING[spec] || spec"></span>
                                        </label>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 5. Performance & Imaging Details -->
                    <section>
                        <h3 class="text-lg font-bold mb-4 text-violet-600 border-b border-slate-100 pb-2">5. Performance
                            & Imaging Details</h3>

                        <div class="space-y-6">
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Performance Metrics
                                    (One per line) <span class="text-red-500">*</span></label>
                                <textarea x-model="formData.performance_metrics" rows="3" placeholder="AUC: 0.95..."
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Imaging Procedures
                                    (Comma Separated)</label>
                                <textarea x-model="formData.imaging_procedures" rows="2"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Imaging
                                    Comments</label>
                                <textarea x-model="formData.imaging_comments" rows="2"
                                    class="w-full p-2.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-900 focus:ring-2 focus:ring-violet-500 outline-none"></textarea>
                            </div>
                        </div>
                    </section>

                </div>

                <div
                    class="p-6 bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700 flex justify-end">
                    <button type="submit" :disabled="submitting || !isFormValid()"
                        :class="!isFormValid() ? 'opacity-50 cursor-not-allowed bg-slate-400' : 'bg-violet-600 hover:bg-violet-700 shadow-lg'"
                        class="px-8 py-3 text-white font-bold rounded-lg transition flex items-center gap-2">
                        <svg x-show="submitting" class="animate-spin -ml-1 mr-2 h-5 w-5 text-white"
                            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                            </circle>
                            <path class="opacity-75" fill="currentColor"
                                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                            </path>
                        </svg>
                        <span
                            x-text="submitting ? 'Saving...' : (submissionId ? 'Update Submission' : 'Submit Model')"></span>
                    </button>
                </div>

            </form>
        </div>
    </div>
</body>

</html>